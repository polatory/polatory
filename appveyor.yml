platform: x64

branches:
  only:
    - master

image: Visual Studio 2017

environment:
  APPVEYOR_SAVE_CACHE_ON_ERROR: true
  CONDA_DIR: C:\Miniconda-x64
  VCPKG_DIR: C:\Tools\vcpkg

init:
  - ps: Get-WmiObject Win32_OperatingSystem
  - ps: Get-WmiObject Win32_Processor
  - vcpkg version

clone_folder: C:\projects\polatory
clone_depth: 5

matrix:
  fast_finish: true

cache:
  - C:\Tools\vcpkg\installed

install:
  - C:\Miniconda-x64\Scripts\conda install mkl-devel=2018.0 -y -c intel
  - echo set(VCPKG_BUILD_TYPE release) >> %VCPKG_DIR%\triplets\x64-windows.cmake
  - vcpkg install ceres flann eigen3 gtest --triplet x64-windows


build:
  parallel: true
  project: build\polatory.sln

before_build:
  - mkdir build && cd build
  - cmake .. -G"Visual Studio 15 2017 Win64" -DCMAKE_BUILD_TYPE="Release" -DCMAKE_CONFIGURATION_TYPES="Release" -DCMAKE_TOOLCHAIN_FILE=%VCPKG_DIR%\scripts\buildsystems\vcpkg.cmake -DBOOST_ROOT=C:\Libraries\boost_1_67_0 -DVCPKG_ROOT=%VCPKG_DIR%\installed\x64-windows


test_script:
  - test\Release\Unittest.exe


deploy: off


notifications:
  - provider: Slack
    incoming_webhook:
      secure: eZ62G+Wy8+cxwZX9zxzx8KLypeWss82zviuRSuNBYTwq0eGHzXyo5JsmpW6TUlJGm1a5TUxcyzihv6c01p44ffgOJZTJX0UU1CxTgQ2xgXc=
